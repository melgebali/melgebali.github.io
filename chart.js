!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.chart=e():t.chart=e()}(window,(function(){return function(t){var e={};function n(a){if(e[a])return e[a].exports;var r=e[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(a,r,function(e){return t[e]}.bind(null,r));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e){looker.plugins.visualizations.add({options:{duration:{type:"number",label:"Animation time",display:"range",max:3e4,min:100,step:100,default:5e3},axiscolor:{type:"string",label:"Axis Color",display:"color",default:"blue"}},create:function(t,e){t.innerHTML="\n        <style>\n          .tmm_main{\n            /* Vertical centering*/\n            height: 100%;\n            display: flex;\n            flex-direction: column;\n            justify-content: center;\n            text-align: center;\n          }\n\n        </style>\n      ";var n=t.appendChild(document.createElement("div")),a=t.clientWidth-100,r=t.clientHeight-20;console.log("Config with width:".concat(a,", height:").concat(r)),n.className="tmm_main";var o=d3.select(".tmm_main");o.selectAll("svg").remove();var i=o.append("svg").attr("preserveAspectRatio","xMinYMin").attr("width","800px").attr("height","600px");this._textElement=n.appendChild(document.createElement("div")),this._svg=i},updateAsync:function(t,e,o,x,g,v){this.clearErrors(),0!=x.fields.dimensions.length&&0!=x.fields.measures.length?(a=x.fields.dimensions[0].name,r=x.fields.measures[0].name,this._svg.selectAll("*").remove(),s=t,l=(l=Object.keys(s[0][r])).filter((function(t){return isNaN(parseInt(t))?0:1})),console.log(l),f=l[c=0],i=[],s.forEach((function(t){i.indexOf(t[a])>-1||i.push(t[a])})),console.log(i),n=d3.scaleOrdinal().domain(i).range(["#ff31dc","#3d21c9","#c0f1ff","#a528de","#1942e9","#baed00","#0127b2","#abff4b","#d72ee5","#00cb44","#ea1ada","#79cd00","#d855ff","#40b300","#67ff81","#5c00a5","#fff134","#6563ff","#f8ff58","#aa5dff","#87b100","#1073ff","#e2ff70","#3a0074","#00de7b","#ff1dbe","#01b04f","#af00a5","#389000","#dd6dff","#b2ff90","#69007e","#ffe966","#7771ff","#ffd450","#0166dc","#b8a000","#0146af","#ffb23e","#017ded","#d60000","#47ffe6","#ef013f","#02e2b5","#e80099","#007010","#ff7bff","#005e1f","#ff369b","#02b984","#b60089","#00eada","#ff313a","#01c1ff","#ff512a","#01b1fb","#e35c00","#0285d6","#ff9c34","#001160","#fffc92","#17003d","#baffb8","#920081","#979300","#c082ff","#a48c00","#8b8dff","#cb8f00","#002f80","#ff703b","#01c8d6","#bb0020","#99ffff","#dc0052","#00b69b","#9c0066","#a8ffd6","#54005c","#fff3b1","#080036","#f2ffd6","#42004c","#c4ffef","#8c0d00","#70e6ff","#8b0026","#00b0d0","#ff7053","#004e96","#b17300","#929eff","#737800","#f398ff","#243a00","#ff7fdc","#008867","#ff67b6","#007e6d","#ff6469","#0183bd","#ff9e60","#00376e","#ffb373","#00193b","#ffe7c0","#240024","#fff6e4","#110006","#f8efff","#200013","#a70050","#9bd6ff","#641f00","#99b2ff","#8a6100","#edafff","#675600","#ff9bef","#191d00","#ffb6e8","#002526","#ff758e","#006d6d","#ff87aa","#004142","#ffb38d","#002d41","#ffcbab","#37001b","#d3deff","#2e0a00","#d7cdff","#8a4c00","#b7bdff","#443e00","#ffdce1","#241200","#ffc0b2","#004c5f","#ffa7b7","#3c2a00","#0078a1","#6f0023","#008599","#610034","#371a00","#511900"]),u.duration=o.duration,u.axiscolor=o.axiscolor,u.allowAnimation=!0,f=l[c=0],function t(e){d3.select(".tmm_main").node().getBoundingClientRect();console.log("-----inside draw chart width:".concat(800,", height:").concat(600),s),console.log(e.node().getBBox()),m(),e.append("text").attr("fill","green").attr("x",160).attr("y",20).attr("class","year").text(" "+f).on("click",(function(){u.allowAnimation?u.allowAnimation=!1:u.allowAnimation=!0,console.log("==PAUSED==",u.allowAnimation)})),e.append("text").attr("fill","blue").attr("x",450).attr("y",20).attr("class","button").text("Replay").on("click",(function(n){e.selectAll("*").remove(),f=l[c=0],u.allowAnimation=!0,t(e)})),console.log("---drawing axis -width, height- ".concat(800," ,  ").concat(600)),p(s,800,600),e.append("g").attr("class","custom-axis").attr("transform","translate(0,640)").attr("fill",u.axiscolor).call(b);var o=e.selectAll("rect").data(s).enter().append("g");o.append("rect").attr("x",30).attr("y",(function(t,e){return 20*e+50})).attr("key",(function(t,e){return e})).attr("width",(function(t){return d(function(t){return null==t||null==t?0:parseFloat(t)}(t[r][f].value))-30})).attr("height",12).attr("fill",(function(t){return n(t[a].value)})).on("click",(function(t){console.log(t)})),o.append("title").attr("class","title").attr("key",(function(t,e){return e})).text((function(t){return t[a].value+" "+t[r][f].value}));var i=o.append("text").attr("x",(function(t){return 10+d(t[r][f].value)})).attr("y",(function(t,e){return 20*e+60})).attr("key",(function(t,e){return e})).attr("font-size",10).attr("fill","black").attr("class","participant").text((function(t){return t[a].value})).node().getComputedTextLength();console.log("textlength: ",i),o.append("text").attr("x",(function(t){return i+10+d(t[r][f].value)})).attr("y",(function(t,e){return 20*e+60})).attr("key",(function(t,e){return e})).attr("font-size",10).attr("fill","black").style("stroke","green").style("stroke-width","0.3px").attr("class","value").attr("data-val",(function(t){return t[r][f].value})).text((function(t){return parseInt(t[r][f].value)})),setTimeout((function(){return function t(e,n){if(console.log("-----Starting transition ",u.allowAnimation),u.allowAnimation){if(++c>l.length-1)return u.allowAnimation=!1,void console.log("Reached end of animation--\x3e",f);f=l[c],console.log(f),m();var o=u.duration,i=d3.transition().ease(d3.easeLinear).duration(o);e.selectAll(".custom-axis").transition(i).call(b).on("start",(function(){p(s),e.select(".custom-axis .domain").remove(),e.select(".custom-axis").attr("fill",u.axiscolor)})),e.selectAll(".year").transition(i).text(" "+f),n.selectAll(".title").transition(i).text((function(t){return console.log(f),t[a].value+" "+t[r][f].rendered})),n.selectAll(".value").transition(i).attr("x",(function(t){return 150+d(t[r][f].value)})).attr("y",(function(t,e,n){return 20*s.indexOf(t)+60})),n.selectAll(".value").transition(i).tween("text",(function(t,e,n){var a=d3.select(n[e]),o=a.attr("data-val"),i=d3.interpolate(o,t[r][f].value);return function(t){a.text(i(t))}})),n.selectAll(".participant").transition(i).attr("x",(function(t){return 50+d(t[r][f].value)})).attr("y",(function(t,e,n){return 20*s.indexOf(t)+60})),n.selectAll("rect").transition(i).attr("width",(function(t){return d(t[r][f].value)-30})).attr("y",(function(t,e,n){return 20*s.indexOf(t)+50})),i.on("end",(function(){console.log(" calling transition!:",c),setTimeout((function(){t(e,n)}),1e3*c)}))}}(e,o)}),1e3)}(this._svg),v()):this.addError({title:"No Dimensions or Measures",message:"This chart requires 1 dimension for participants and 1 measure with data as a pivot table for years or time."})}});var n,a,r,o,i=[],f=0,l=[],c=0,u={duration:1e4,axiscolor:"blue",allowAnimation:!0},s={},d=null;function p(t,e,n){var a=d3.extent(t,(function(t){return t[r][f].value}));null==d?d=d3.scaleLinear().domain(a).range([30,600]):d.domain(a),console.log("currentYear:".concat(f,", width:").concat(800,", height:").concat(600),a,d(a[0]),d(a[1])),o=d3.axisTop().scale(d).tickSize(600)}function b(t){var e=u.axiscolor;t.call(o),t.select(".domain").remove(),t.selectAll(".tick").attr("color",e),t.selectAll(".tick line").attr("stroke",e).attr("stroke-dasharray","1,9"),t.selectAll(".tick text").attr("x","4px").attr("dy","-4px")}function m(){s=s.sort((function(t,e,n){return e[r][f].value-t[r][f].value}))}}])}));